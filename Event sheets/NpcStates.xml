<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>NpcStates</name>
    <events>
        <event-block sid="1168637109888776">
            <conditions>
                <condition id="0" name="On function" sid="9122190867031012" type="Function">
                    <param id="0" name="Name">&quot;Npc_Move&quot;</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="9403458476095014" type="NPC">
                    <param id="0" name="Unique ID">Function.Param(2)</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="9482415715265581">
                    <conditions>
                        <condition id="1" name="Compare parameter" sid="4108549271731483" type="Function">
                            <param id="0" name="Index">0</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Value">NPC.X</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="8568459483589438">
                            <conditions>
                                <condition id="1" name="Compare parameter" sid="1823852638220341" type="Function">
                                    <param id="0" name="Index">0</param>
                                    <param id="1" name="Comparison">2</param>
                                    <param id="2" name="Value">NPC.X</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="6503910799918848" type="NPC">
                                    <param id="0" name="Which">1</param>
                                    <param id="1" name="Speed">-1</param>
                                </action>
                                <action id="-1" name="Set X" sid="7045486235477483" type="NPC">
                                    <param id="0" name="X">NPC.X-1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="8125432300097966">
                            <conditions>
                                <condition id="-22" name="Else" sid="9534817471189844" type="System" />
                            </conditions>
                            <actions>
                                <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="6559856610184379" type="NPC">
                                    <param id="0" name="Which">1</param>
                                    <param id="1" name="Speed">1</param>
                                </action>
                                <action id="-1" name="Set X" sid="7498898775674949" type="NPC">
                                    <param id="0" name="X">NPC.X+1</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="9031904885653385">
                    <conditions>
                        <condition id="-22" name="Else" sid="1287574673763512" type="System" />
                        <condition behavior="NpcMovement" disabled="1" id="1" name="Compare speed" sid="3173241570340144" type="NPC">
                            <param id="0" name="Which">1</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Speed">0</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="3063092244710099" type="NPC">
                            <param id="0" name="Which">1</param>
                            <param id="1" name="Speed">0</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="4194708111403091">
                    <conditions>
                        <condition id="1" name="Compare parameter" sid="6212105499590271" type="Function">
                            <param id="0" name="Index">1</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Value">NPC.Y</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="8756342336725966">
                            <conditions>
                                <condition id="1" name="Compare parameter" sid="2165032708998414" type="Function">
                                    <param id="0" name="Index">1</param>
                                    <param id="1" name="Comparison">2</param>
                                    <param id="2" name="Value">NPC.Y</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="9084637561014125" type="NPC">
                                    <param id="0" name="Which">2</param>
                                    <param id="1" name="Speed">-1</param>
                                </action>
                                <action id="-2" name="Set Y" sid="5814359836750812" type="NPC">
                                    <param id="0" name="Y">NPC.Y-1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="9778009781757058">
                            <conditions>
                                <condition id="-22" name="Else" sid="6585436388491209" type="System" />
                            </conditions>
                            <actions>
                                <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="6014937367460471" type="NPC">
                                    <param id="0" name="Which">2</param>
                                    <param id="1" name="Speed">1</param>
                                </action>
                                <action id="-2" name="Set Y" sid="1821056526839751" type="NPC">
                                    <param id="0" name="Y">NPC.Y+1</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="5254813104538947">
                    <conditions>
                        <condition id="-22" name="Else" sid="8961063133460749" type="System" />
                        <condition behavior="NpcMovement" disabled="1" id="1" name="Compare speed" sid="8808588700401054" type="NPC">
                            <param id="0" name="Which">2</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Speed">0</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action behavior="NpcMovement" disabled="1" id="2" name="Set speed" sid="8799874062225891" type="NPC">
                            <param id="0" name="Which">2</param>
                            <param id="1" name="Speed">0</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="9164566053937344">
                    <conditions />
                    <actions>
                        <action id="-3" name="Set position" sid="4973163981093588" type="NPC">
                            <param id="0" name="X">floor(NPC.X)</param>
                            <param id="1" name="Y">floor(NPC.Y)</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="5987078465959126">
            <conditions>
                <condition id="0" name="On function" sid="6564671941010253" type="Function">
                    <param id="0" name="Name">&quot;Npc_RandomWalk&quot;</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="5741506023929106" type="NPC">
                    <param id="0" name="Unique ID">Function.Param(0)</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="1749492469289909" type="NPCData">
                    <param id="0" name="Unique ID">NPC.DataUID</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="3513901554025319" type="FSM">
                    <param id="0" name="Unique ID">NPC.FSM_UID</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="7059938272094139">
                    <conditions>
                        <condition id="3" inverted="1" name="Has key" sid="972631647405931" type="NPCData">
                            <param id="0" name="Key">&quot;StateConstructor&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="0" name="Add key" sid="7209645218942675" type="NPCData">
                            <param id="0" name="Key">&quot;StateConstructor&quot;</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="0" name="Add key" sid="7141590873241375" type="NPCData">
                            <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="0" name="Add key" sid="3806548444966599" type="NPCData">
                            <param id="0" name="Key">&quot;cNode&quot;</param>
                            <param id="1" name="Value">0</param>
                        </action>
                    </actions>
                </event-block>
                <comment>we ad the ranom x and y in this event beacuse we delete them later in this state so next tick it finds a new random position.</comment>
                <event-block any="1" sid="6810581966355864">
                    <conditions>
                        <condition id="3" inverted="1" name="Has key" sid="5800137367260807" type="NPCData">
                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                        </condition>
                        <condition id="3" inverted="1" name="Has key" sid="6364420991031863" type="NPCData">
                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="0" name="Add key" sid="4082948041806585" type="NPCData">
                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                            <param id="1" name="Value">floor(random(-320, 480)+NPC.X)</param>
                        </action>
                        <action id="0" name="Add key" sid="7667958219704733" type="NPCData">
                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                            <param id="1" name="Value">floor(random(-320, 480)+NPC.Y)</param>
                        </action>
                    </actions>
                </event-block>
                <comment>Has No Path</comment>
                <event-block sid="3277864495060578">
                    <conditions>
                        <condition id="0" name="Compare value" sid="8955033701664706" type="NPCData">
                            <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                            <param id="1" name="Comparison">0</param>
                            <param id="2" name="Value">0</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="4312430502141125">
                            <conditions>
                                <condition id="3" name="Has key" sid="7623281967704721" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToX&quot;</param>
                                </condition>
                                <condition id="3" name="Has key" sid="4187950244431162" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToY&quot;</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action behavior="Pathfinding" id="0" name="Find path" sid="813055248974843" type="NPC">
                                    <param id="0" name="X">NPCData.Get(&quot;walkToX&quot;)</param>
                                    <param id="1" name="Y">NPCData.Get(&quot;walkToY&quot;)</param>
                                </action>
                                <action id="1" name="Set key" sid="3135196148266181" type="NPCData">
                                    <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                                    <param id="1" name="Value">2</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <comment>Has Found Path</comment>
                <event-block sid="9848888358304456">
                    <conditions>
                        <condition id="-22" name="Else" sid="751265350852076" type="System" />
                        <condition id="0" name="Compare value" sid="449121067335696" type="NPCData">
                            <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                            <param id="1" name="Comparison">0</param>
                            <param id="2" name="Value">1</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <comment>if the npc is at the current node in the path then incement the cNode</comment>
                        <event-block sid="2408469186931555">
                            <conditions>
                                <condition id="-21" name="Is between values" sid="2766901953616258" type="System">
                                    <param id="0" name="Value">NPC.X</param>
                                    <param id="1" name="Lower bound">int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 0, &quot;,&quot;))-4</param>
                                    <param id="2" name="Upper bound">int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 0, &quot;,&quot;))+4</param>
                                </condition>
                                <condition id="-21" name="Is between values" sid="236551584636969" type="System">
                                    <param id="0" name="Value">NPC.Y</param>
                                    <param id="1" name="Lower bound">int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 1, &quot;,&quot;))-4</param>
                                    <param id="2" name="Upper bound">int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 1, &quot;,&quot;))+4</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="5" name="Push" sid="3168150528982324" type="Array">
                                    <param id="0" name="Where">0</param>
                                    <param id="1" name="Value">NPCData.Get(&quot;cNode&quot;)</param>
                                    <param id="2" name="Axis">0</param>
                                </action>
                                <action id="1" name="Set key" sid="8435335616433903" type="NPCData">
                                    <param id="0" name="Key">&quot;cNode&quot;</param>
                                    <param id="1" name="Value">int(NPCData.Get(&quot;cNode&quot;))+1</param>
                                </action>
                            </actions>
                        </event-block>
                        <comment>if the Npc has Arrived at its Destionation then we  basicly zero out its state and start again.</comment>
                        <event-block sid="4269589562406942">
                            <conditions>
                                <condition id="0" name="Compare value" sid="8793163989027458" type="NPCData">
                                    <param id="0" name="Key">&quot;cNode&quot;</param>
                                    <param id="1" name="Comparison">5</param>
                                    <param id="2" name="Value">tokencount(NPCData.Get(&quot;pathfindingPath&quot;), &quot; &quot;)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="2" name="Delete key" sid="9234809851279564" type="NPCData">
                                    <param id="0" name="Key">&quot;StateConstructor&quot;</param>
                                </action>
                                <action id="2" name="Delete key" sid="4731316438750168" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToX&quot;</param>
                                </action>
                                <action id="2" name="Delete key" sid="3824486034446516" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToY&quot;</param>
                                </action>
                                <action id="2" name="Delete key" sid="853440257163691" type="NPCData">
                                    <param id="0" name="Key">&quot;pathfindingPath&quot;</param>
                                </action>
                                <action id="1" name="Set key" sid="4566400588041836" type="NPCData">
                                    <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="1" name="Set key" sid="4070531443950077" type="NPCData">
                                    <param id="0" name="Key">&quot;cNode&quot;</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="8947106985687198">
                            <conditions />
                            <actions>
                                <action id="0" name="Call function" sid="5478971688997011" type="Function">
                                    <param id="0" name="Name">&quot;Npc_Move&quot;</param>
                                    <param id="1" name="Parameter {n}">int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 0, &quot;,&quot;)){###}int(tokenat(tokenat(NPCData.Get(&quot;pathfindingPath&quot;), NPCData.Get(&quot;cNode&quot;), &quot; &quot;), 1, &quot;,&quot;)){###}NPC.UID</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <comment>Was looking for path and there isnt one</comment>
                <event-block sid="4254875191638027">
                    <conditions>
                        <condition id="-22" name="Else" sid="5642219214892835" type="System" />
                        <condition id="0" name="Compare value" sid="6188464178461738" type="NPCData">
                            <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                            <param id="1" name="Comparison">0</param>
                            <param id="2" name="Value">-1</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Set key" sid="9757942503318872" type="NPCData">
                            <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="1" name="Set key" sid="3744186905211123" type="NPCData">
                            <param id="0" name="Key">&quot;cNode&quot;</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="2" name="Delete key" sid="7802494652267251" type="NPCData">
                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                        </action>
                        <action id="2" name="Delete key" sid="6233400189573139" type="NPCData">
                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="7694806584719394">
            <conditions>
                <condition behavior="Pathfinding" id="0" name="On path found" sid="2674989115371001" type="NPC" />
                <condition id="-14" name="Pick by unique ID" sid="587298410406966" type="NPCData">
                    <param id="0" name="Unique ID">NPC.DataUID</param>
                </condition>
            </conditions>
            <actions>
                <action id="1" name="Set key" sid="3672416638472511" type="NPCData">
                    <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                    <param id="1" name="Value">1</param>
                </action>
            </actions>
            <sub-events>
                <event-block sid="7051698786768293">
                    <conditions>
                        <condition id="-12" name="Repeat" sid="7505866290492707" type="System">
                            <param id="0" name="Count">NPC.Pathfinding.NodeCount</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="959504294824407">
                            <conditions>
                                <condition id="-8" name="Compare two values" sid="2163678982246188" type="System">
                                    <param id="0" name="First value">loopindex</param>
                                    <param id="1" name="Comparison">1</param>
                                    <param id="2" name="Second value">0</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="1" name="Set key" sid="6524930803270762" type="NPCData">
                                    <param id="0" name="Key">&quot;pathfindingPath&quot;</param>
                                    <param id="1" name="Value">NPCData.Get(&quot;pathfindingPath&quot;)&amp;&quot; &quot;&amp;NPC.Pathfinding.NodeXAt(loopindex)&amp;&quot;,&quot;&amp;NPC.Pathfinding.NodeYAt(loopindex)</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="204470709597159">
                            <conditions>
                                <condition id="-22" name="Else" sid="6385463642934288" type="System" />
                            </conditions>
                            <actions>
                                <action id="0" name="Add key" sid="8118479577269236" type="NPCData">
                                    <param id="0" name="Key">&quot;pathfindingPath&quot;</param>
                                    <param id="1" name="Value">NPC.Pathfinding.NodeXAt(loopindex)&amp;&quot;,&quot;&amp;NPC.Pathfinding.NodeYAt(loopindex)</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="7416295254104543">
            <conditions>
                <condition behavior="Pathfinding" id="1" name="On failed to find path" sid="1850585152534084" type="NPC" />
                <condition id="-14" name="Pick by unique ID" sid="1024032979337713" type="NPCData">
                    <param id="0" name="Unique ID">NPC.DataUID</param>
                </condition>
            </conditions>
            <actions>
                <action id="1" name="Set key" sid="9465060117975817" type="NPCData">
                    <param id="0" name="Key">&quot;hasPathfindingPath&quot;</param>
                    <param id="1" name="Value">-1</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="7964120711316115">
            <conditions>
                <condition id="-2" name="On start of layout" sid="9363859125955357" type="System" />
            </conditions>
            <actions>
                <action behavior="Pathfinding" id="5" name="Add obstacle" sid="4462476215018786" type="NPC">
                    <param id="0" name="Obstacle">ObstacleTilemap</param>
                </action>
                <action behavior="Pathfinding" id="5" name="Add obstacle" sid="8531907612060939" type="NPC">
                    <param id="0" name="Obstacle">Solid</param>
                </action>
                <action behavior="Pathfinding" id="5" name="Add obstacle" sid="8181130801805182" type="NPC">
                    <param id="0" name="Obstacle">Tilemap</param>
                </action>
            </actions>
        </event-block>
    </events>
</c2eventsheet>
